machine:
  ruby:
    version: 2.3.3
  services:
    - docker
dependencies:
  pre:
    - gem install --no-ri --no-rdoc ufo
  override:
    - cp .env.example .env
database:
  override:
    - cat /dev/null
test:
  override:
    - ufo docker build
    - docker tag $(ufo docker image_name) hi_web
    - docker-compose run web bundle exec rake db:create db:migrate
    - docker-compose run web bundle exec rake
deployment:
 staging:
   branch: circle-ecs
   commands:
     - ufo ship hi-web --cluster stag --no-docker --no-wait
